<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Product</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Product</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/product_rb.html">
                app/models/product.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000106">absolutely_priced?</a>&nbsp;&nbsp;
      <a href="#M000095">add_component</a>&nbsp;&nbsp;
      <a href="#M000089">calculate_component_pricing</a>&nbsp;&nbsp;
      <a href="#M000083">calculate_rebate</a>&nbsp;&nbsp;
      <a href="#M000102">calculated_margin_percentage</a>&nbsp;&nbsp;
      <a href="#M000090">component_gross_price</a>&nbsp;&nbsp;
      <a href="#M000091">component_margin</a>&nbsp;&nbsp;
      <a href="#M000092">component_purchase_price</a>&nbsp;&nbsp;
      <a href="#M000097">component_stock</a>&nbsp;&nbsp;
      <a href="#M000104">componentized?</a>&nbsp;&nbsp;
      <a href="#M000100">csv_header</a>&nbsp;&nbsp;
      <a href="#M000082">gross_price</a>&nbsp;&nbsp;
      <a href="#M000103">in_a_document?</a>&nbsp;&nbsp;
      <a href="#M000086">margin</a>&nbsp;&nbsp;
      <a href="#M000098">new_from_supply_item</a>&nbsp;&nbsp;
      <a href="#M000105">on_sale?</a>&nbsp;&nbsp;
      <a href="#M000080">per_page</a>&nbsp;&nbsp;
      <a href="#M000093">pretty_margin</a>&nbsp;&nbsp;
      <a href="#M000094">pretty_taxes</a>&nbsp;&nbsp;
      <a href="#M000081">price</a>&nbsp;&nbsp;
      <a href="#M000087">price_before_rebate</a>&nbsp;&nbsp;
      <a href="#M000107">profitable?</a>&nbsp;&nbsp;
      <a href="#M000109">purchase_price</a>&nbsp;&nbsp;
      <a href="#M000084">rebate</a>&nbsp;&nbsp;
      <a href="#M000096">remove_component</a>&nbsp;&nbsp;
      <a href="#M000088">rounded_price_before_rebate</a>&nbsp;&nbsp;
      <a href="#M000110">stock</a>&nbsp;&nbsp;
      <a href="#M000085">taxes</a>&nbsp;&nbsp;
      <a href="#M000101">to_csv_array</a>&nbsp;&nbsp;
      <a href="#M000099">to_s</a>&nbsp;&nbsp;
      <a href="#M000108">weight</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000100" class="method-detail">
        <a name="M000100"></a>

        <div class="method-heading">
          <a href="#M000100" class="method-signature">
          <span class="method-name">csv_header</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generate a header matching the kind of columns that are actually available
for our <a href="Product.html">Product</a> objects.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000100-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000100-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 276</span>
276:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">csv_header</span>
277:     [<span class="ruby-value str">&quot;id&quot;</span>,<span class="ruby-value str">&quot;manufacturer_product_code&quot;</span>,<span class="ruby-value str">&quot;name&quot;</span>,<span class="ruby-value str">&quot;description&quot;</span>, <span class="ruby-value str">&quot;price_excluding_vat&quot;</span>, <span class="ruby-value str">&quot;price_including_vat&quot;</span>, <span class="ruby-value str">&quot;price_including_shipping&quot;</span>, <span class="ruby-value str">&quot;vat&quot;</span>, <span class="ruby-value str">&quot;shipping_cost&quot;</span>, <span class="ruby-value str">&quot;stock&quot;</span>, <span class="ruby-value str">&quot;availability&quot;</span>, <span class="ruby-value str">&quot;weight_in_kg&quot;</span>]
278:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000098" class="method-detail">
        <a name="M000098"></a>

        <div class="method-heading">
          <a href="#M000098" class="method-signature">
          <span class="method-name">new_from_supply_item</span><span class="method-args">(si)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000098-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000098-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 250</span>
250:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_from_supply_item</span>(<span class="ruby-identifier">si</span>)
251:     <span class="ruby-identifier">p</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new</span>
252:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">name</span>
253:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">description</span>
254:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">purchase_price</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">purchase_price</span>
255:     <span class="ruby-comment cmt"># Can be improved by flexibly reading the tax percentage from the CSV file in a first</span>
256:     <span class="ruby-comment cmt"># step and then assigning it to a supply item, and THEN reading a proper TaxClass object from there</span>
257:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">tax_class</span> = <span class="ruby-constant">TaxClass</span>.<span class="ruby-identifier">find_by_percentage</span>(<span class="ruby-value str">&quot;7.6&quot;</span>)
258:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">margin_percentage</span> = <span class="ruby-value">5.0</span>
259:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">supplier_id</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">supplier_id</span>
260:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">supply_item_id</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">id</span>
261:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">weight</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">weight</span>
262:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">supplier_product_code</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">supplier_product_code</span>
263:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">manufacturer_product_code</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">manufacturer_product_code</span>
264:     <span class="ruby-identifier">p</span>.<span class="ruby-identifier">stock</span> = <span class="ruby-identifier">si</span>.<span class="ruby-identifier">stock</span>
265:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">p</span>
266:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000080" class="method-detail">
        <a name="M000080"></a>

        <div class="method-heading">
          <a href="#M000080" class="method-signature">
          <span class="method-name">per_page</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Pagination with will_paginate
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000080-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000080-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/product.rb, line 32</span>
32:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">per_page</span>
33:     <span class="ruby-keyword kw">return</span> <span class="ruby-value">50</span>
34:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">absolutely_priced?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Is this product priced via an absolutely defined sales price?
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 318</span>
318:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">absolutely_priced?</span>
319:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sales_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">sales_price</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">sales_price</span> <span class="ruby-operator">==</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0.0&quot;</span>)
320:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
321:     <span class="ruby-keyword kw">else</span>
322:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
323:     <span class="ruby-keyword kw">end</span>
324:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000095" class="method-detail">
        <a name="M000095"></a>

        <div class="method-heading">
          <a href="#M000095" class="method-signature">
          <span class="method-name">add_component</span><span class="method-args">(product, quantity = 1)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000095-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000095-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 174</span>
174:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_component</span>(<span class="ruby-identifier">product</span>, <span class="ruby-identifier">quantity</span> = <span class="ruby-value">1</span>)
175:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">product</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;SupplyItem&quot;</span>
176:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;Only supply items can be added as components to other products.&quot;</span>
177:     <span class="ruby-keyword kw">end</span>
178: 
179:     <span class="ruby-identifier">incremented</span> = <span class="ruby-keyword kw">false</span>
180:     <span class="ruby-identifier">saved</span> = <span class="ruby-keyword kw">false</span>
181:     
182:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">product_sets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ps</span><span class="ruby-operator">|</span>
183:       <span class="ruby-comment cmt"># Found an existing product set with the same component/product</span>
184:       <span class="ruby-comment cmt"># pair, thus we just augment</span>
185:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">component</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">product</span>
186:         <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">quantity</span>
187:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">save</span>
188:           <span class="ruby-identifier">incremented</span> = <span class="ruby-keyword kw">true</span>
189:           <span class="ruby-identifier">saved</span> = <span class="ruby-keyword kw">true</span>
190:         <span class="ruby-keyword kw">end</span>
191:       <span class="ruby-keyword kw">end</span>
192:     <span class="ruby-keyword kw">end</span>
193:     
194:     <span class="ruby-comment cmt"># No existing pair was found, we need to create a new one</span>
195:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">incremented</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
196:       <span class="ruby-identifier">ps</span> = <span class="ruby-constant">ProductSet</span>.<span class="ruby-identifier">new</span>
197:       <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span> = <span class="ruby-identifier">quantity</span>
198:       <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">component</span> = <span class="ruby-identifier">product</span>
199:       <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">product</span> = <span class="ruby-keyword kw">self</span>
200:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">save</span>
201:         <span class="ruby-identifier">saved</span> = <span class="ruby-keyword kw">true</span>
202:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>
203:       <span class="ruby-keyword kw">end</span>
204:     <span class="ruby-keyword kw">end</span>
205:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">saved</span>
206:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000089" class="method-detail">
        <a name="M000089"></a>

        <div class="method-heading">
          <a href="#M000089" class="method-signature">
          <span class="method-name">calculate_component_pricing</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calculates all three pricing items (<a
href="Product.html#M000081">price</a>, <a
href="Product.html#M000085">taxes</a> and <a
href="Product.html#M000086">margin</a>) for products that consist of
multiple products. This assigns all three results in one go so that a lot
less calculation is necessary.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000089-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000089-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 117</span>
117:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">calculate_component_pricing</span>
118:     <span class="ruby-identifier">purchase_price</span> = <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0&quot;</span>)
119:     <span class="ruby-identifier">price</span> = <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0&quot;</span>)
120:     <span class="ruby-identifier">margin</span> = <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0&quot;</span>)
121:     <span class="ruby-comment cmt"># Safeguard to prevent calculation on straightforward simple products</span>
122:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">componentized?</span>  
123:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">product_sets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ps</span><span class="ruby-operator">|</span>
124:         <span class="ruby-identifier">purchase_price</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">component</span>.<span class="ruby-identifier">purchase_price</span>
125:       <span class="ruby-keyword kw">end</span>
126:       <span class="ruby-comment cmt"># We must use the compound product's tax class for legal reasons, no matter what</span>
127:       <span class="ruby-comment cmt"># tax class the constituent components may have.</span>
128:             
129:       <span class="ruby-identifier">margin</span> = (<span class="ruby-identifier">purchase_price</span> <span class="ruby-operator">/</span> <span class="ruby-value">100.0</span>) <span class="ruby-operator">*</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">margin_percentage</span>
130:       <span class="ruby-identifier">gross_price</span> = <span class="ruby-identifier">purchase_price</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">margin</span>
131:     <span class="ruby-keyword kw">end</span>
132:     <span class="ruby-ivar">@component_pricing</span> <span class="ruby-operator">||=</span> [<span class="ruby-identifier">gross_price</span>, <span class="ruby-identifier">margin</span>, <span class="ruby-identifier">purchase_price</span>]
133:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@component_pricing</span>
134:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000083" class="method-detail">
        <a name="M000083"></a>

        <div class="method-heading">
          <a href="#M000083" class="method-signature">
          <span class="method-name">calculate_rebate</span><span class="method-args">(price)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000083-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000083-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/product.rb, line 56</span>
56:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">calculate_rebate</span>(<span class="ruby-identifier">price</span>)
57:     <span class="ruby-identifier">rebate</span> = <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0&quot;</span>)
58:     <span class="ruby-identifier">end_date</span> = <span class="ruby-identifier">rebate_until</span> <span class="ruby-operator">||</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">1940</span>,<span class="ruby-value">01</span>,<span class="ruby-value">01</span>) 
59:     
60:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">end_date</span>
61:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">absolute_rebate</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">absolute_rebate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
62:         <span class="ruby-identifier">rebate</span> = <span class="ruby-identifier">absolute_rebate</span>
63:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">percentage_rebate</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">percentage_rebate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
64:         <span class="ruby-identifier">rebate</span> = (((<span class="ruby-identifier">price</span> <span class="ruby-operator">/</span> <span class="ruby-value">100.0</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">percentage_rebate</span>) <span class="ruby-operator">/</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;5&quot;</span>)).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-operator">*</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;5&quot;</span>)  
65:       <span class="ruby-keyword kw">end</span>
66:     <span class="ruby-keyword kw">end</span>
67:     
68:     <span class="ruby-comment cmt"># This check makes sure only loss-leader products can go below their purchase</span>
69:     <span class="ruby-comment cmt"># price through a rebate.</span>
70:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">price</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">rebate</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">purchase_price</span>
71:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_loss_leader?</span>
72:         <span class="ruby-identifier">rebate</span> = <span class="ruby-value">0</span>
73:       <span class="ruby-keyword kw">end</span>
74:     <span class="ruby-keyword kw">end</span>
75:     
76:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">rebate</span>
77:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="#M000102" class="method-signature">
          <span class="method-name">calculated_margin_percentage</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000102-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000102-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 295</span>
295:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">calculated_margin_percentage</span>
296:     <span class="ruby-identifier">percentage</span> = (<span class="ruby-value">100.0</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">gross_price</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">margin</span>
297:     <span class="ruby-constant">BigDecimal</span>(<span class="ruby-identifier">percentage</span>.<span class="ruby-identifier">to_s</span>)
298:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000090" class="method-detail">
        <a name="M000090"></a>

        <div class="method-heading">
          <a href="#M000090" class="method-signature">
          <span class="method-name">component_gross_price</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000090-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000090-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 136</span>
136:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">component_gross_price</span>
137:     <span class="ruby-identifier">calculate_component_pricing</span>
138:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@component_pricing</span>[<span class="ruby-value">0</span>]
139:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000091" class="method-detail">
        <a name="M000091"></a>

        <div class="method-heading">
          <a href="#M000091" class="method-signature">
          <span class="method-name">component_margin</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000091-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000091-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 141</span>
141:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">component_margin</span>    
142:     <span class="ruby-identifier">calculate_component_pricing</span>
143:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@component_pricing</span>[<span class="ruby-value">1</span>]
144:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000092" class="method-detail">
        <a name="M000092"></a>

        <div class="method-heading">
          <a href="#M000092" class="method-signature">
          <span class="method-name">component_purchase_price</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000092-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000092-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 146</span>
146:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">component_purchase_price</span>
147:     <span class="ruby-identifier">calculate_component_pricing</span>
148:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@component_pricing</span>[<span class="ruby-value">2</span>]
149:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000097" class="method-detail">
        <a name="M000097"></a>

        <div class="method-heading">
          <a href="#M000097" class="method-signature">
          <span class="method-name">component_stock</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns how many of these products we could build based on the <a
href="Product.html#M000110">stock</a> levels of its components at our
suppliers.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000097-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000097-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 229</span>
229:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">component_stock</span>
230:     <span class="ruby-identifier">stock_levels</span> = []
231:     <span class="ruby-identifier">product_sets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ps</span><span class="ruby-operator">|</span>
232:       <span class="ruby-comment cmt"># If any component's stock is below the required quantity, we can impossibly</span>
233:       <span class="ruby-comment cmt"># put together this product, so stock becomes immediately 0 as soon as we</span>
234:       <span class="ruby-comment cmt"># hit one of these combinations.</span>
235:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">component</span>.<span class="ruby-identifier">stock</span>
236:         <span class="ruby-identifier">stock_levels</span> = [<span class="ruby-value">0</span>]
237:         <span class="ruby-keyword kw">break</span>        
238:       <span class="ruby-keyword kw">else</span>
239:         <span class="ruby-comment cmt"># Since we are computing stock from integers, we will always receive the maximum</span>
240:         <span class="ruby-comment cmt"># number of constructable products per component from the division.</span>
241:         <span class="ruby-comment cmt"># Just as if we had used this more explicit calcluation:</span>
242:         <span class="ruby-comment cmt"># (ps.component.stock.to_f / ps.quantity.to_f).floor</span>
243:         <span class="ruby-identifier">stock_levels</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">ps</span>.<span class="ruby-identifier">component</span>.<span class="ruby-identifier">stock</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span>.<span class="ruby-identifier">to_i</span>)
244:       <span class="ruby-keyword kw">end</span>
245:     <span class="ruby-keyword kw">end</span>
246:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">stock_levels</span>.<span class="ruby-identifier">min</span>
247:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">componentized?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 309</span>
309:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">componentized?</span>
310:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">components</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
311:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000082" class="method-detail">
        <a name="M000082"></a>

        <div class="method-heading">
          <a href="#M000082" class="method-signature">
          <span class="method-name">gross_price</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The gross <a href="Product.html#M000081">price</a> is the <a
href="Product.html#M000081">price</a> + <a
href="Product.html#M000086">margin</a> (or sales <a
href="Product.html#M000081">price</a>, in case of absolutely priced goods).
Taxes and <a href="Product.html#M000084">rebate</a> are not yet processed
here.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000082-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000082-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/product.rb, line 46</span>
46:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gross_price</span>
47:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">componentized?</span>
48:       <span class="ruby-identifier">gross_price</span> = <span class="ruby-identifier">component_gross_price</span>
49:     <span class="ruby-keyword kw">else</span>
50:       <span class="ruby-identifier">absolutely_priced?</span> <span class="ruby-value">? </span><span class="ruby-identifier">gross_price</span> = <span class="ruby-identifier">sales_price</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">gross_price</span> = <span class="ruby-identifier">calculated_gross_price</span>
51:     <span class="ruby-keyword kw">end</span>
52:      
53:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">gross_price</span>
54:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="#M000103" class="method-signature">
          <span class="method-name">in_a_document?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Boolean statuses that need processing (non-trivial booleans that
can&#8216;t be handled by ActiveRecord itself)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000103-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000103-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 303</span>
303:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">in_a_document?</span>
304:     <span class="ruby-identifier">state</span> = <span class="ruby-keyword kw">false</span>
305:     <span class="ruby-identifier">state</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">document_lines</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
306:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">state</span>
307:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000086" class="method-detail">
        <a name="M000086"></a>

        <div class="method-heading">
          <a href="#M000086" class="method-signature">
          <span class="method-name">margin</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000086-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000086-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 93</span>
 93:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">margin</span>
 94:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">componentized?</span>
 95:       <span class="ruby-identifier">component_margin</span>
 96:     <span class="ruby-keyword kw">else</span>
 97:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">absolutely_priced?</span>
 98:         <span class="ruby-identifier">sales_price</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">purchase_price</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">taxes</span>
 99:       <span class="ruby-keyword kw">else</span>
100:         <span class="ruby-identifier">calculated_margin</span>
101:       <span class="ruby-keyword kw">end</span>
102:     <span class="ruby-keyword kw">end</span>
103:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">on_sale?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 313</span>
313:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">on_sale?</span>
314:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rebate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
315:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000093" class="method-detail">
        <a name="M000093"></a>

        <div class="method-heading">
          <a href="#M000093" class="method-signature">
          <span class="method-name">pretty_margin</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
More or less formatting-related methods. They are useful in views. Could be
refactored to views or perhaps helpers if necessary.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000093-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000093-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 154</span>
154:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pretty_margin</span>
155:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">purchase_price</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">margin</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
156:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">componentized?</span>
157:         <span class="ruby-identifier">percent_string</span> = <span class="ruby-identifier">calculated_margin_percentage</span>.<span class="ruby-identifier">round</span>(<span class="ruby-value">3</span>).<span class="ruby-identifier">to_s</span>
158:       <span class="ruby-keyword kw">else</span>
159:         <span class="ruby-identifier">percent_string</span> = ((<span class="ruby-value">100</span><span class="ruby-operator">/</span><span class="ruby-identifier">purchase_price</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">margin</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">3</span>).<span class="ruby-identifier">to_s</span>
160:       <span class="ruby-keyword kw">end</span>
161:       
162:        <span class="ruby-identifier">string</span> = <span class="ruby-identifier">sprintf</span> <span class="ruby-value str">&quot;%.2f&quot;</span>, <span class="ruby-identifier">margin</span>
163:        <span class="ruby-identifier">pretty_margin</span> = <span class="ruby-identifier">percent_string</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;% = &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">string</span>
164:     <span class="ruby-keyword kw">else</span>
165:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sprintf</span> <span class="ruby-value str">&quot;%.2f&quot;</span>, <span class="ruby-value">0</span>
166:     <span class="ruby-keyword kw">end</span>
167:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000094" class="method-detail">
        <a name="M000094"></a>

        <div class="method-heading">
          <a href="#M000094" class="method-signature">
          <span class="method-name">pretty_taxes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000094-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000094-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 169</span>
169:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pretty_taxes</span>
170:     <span class="ruby-identifier">string</span> = <span class="ruby-identifier">sprintf</span> <span class="ruby-value str">&quot;%.2f&quot;</span>, <span class="ruby-identifier">taxes</span>
171:     <span class="ruby-identifier">tax_class</span>.<span class="ruby-identifier">percentage</span>.<span class="ruby-identifier">round</span>(<span class="ruby-value">3</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;% = &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">string</span>
172:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000081" class="method-detail">
        <a name="M000081"></a>

        <div class="method-heading">
          <a href="#M000081" class="method-signature">
          <span class="method-name">price</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000081-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000081-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/product.rb, line 36</span>
36:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">price</span>
37:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">absolutely_priced?</span>
38:       <span class="ruby-identifier">gross_price</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">calculate_rebate</span>(<span class="ruby-identifier">gross_price</span>)
39:     <span class="ruby-keyword kw">else</span>
40:       <span class="ruby-identifier">gross_price</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">calculate_rebate</span>(<span class="ruby-identifier">gross_price</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">taxes</span>
41:     <span class="ruby-keyword kw">end</span>
42:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000087" class="method-detail">
        <a name="M000087"></a>

        <div class="method-heading">
          <a href="#M000087" class="method-signature">
          <span class="method-name">price_before_rebate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000087-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000087-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 105</span>
105:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">price_before_rebate</span>
106:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">price</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rebate</span>
107:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">profitable?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 326</span>
326:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">profitable?</span>
327:     <span class="ruby-identifier">gross_price</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">purchase_price</span>
328:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">purchase_price</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 346</span>
346:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">purchase_price</span>
347:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">componentized?</span>
348:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">component_purchase_price</span>
349:     <span class="ruby-keyword kw">else</span>
350:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">read_attribute</span> <span class="ruby-operator">:</span><span class="ruby-identifier">purchase_price</span>
351:     <span class="ruby-keyword kw">end</span>
352:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000084" class="method-detail">
        <a name="M000084"></a>

        <div class="method-heading">
          <a href="#M000084" class="method-signature">
          <span class="method-name">rebate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000084-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000084-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/product.rb, line 79</span>
79:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rebate</span>
80:     <span class="ruby-identifier">calculate_rebate</span>(<span class="ruby-identifier">price</span>)
81:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000096" class="method-detail">
        <a name="M000096"></a>

        <div class="method-heading">
          <a href="#M000096" class="method-signature">
          <span class="method-name">remove_component</span><span class="method-args">(component, quantity)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000096-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000096-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 209</span>
209:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_component</span>(<span class="ruby-identifier">component</span>, <span class="ruby-identifier">quantity</span>)
210:     <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">false</span>
211:     <span class="ruby-identifier">quantity</span> = <span class="ruby-identifier">quantity</span>.<span class="ruby-identifier">to_i</span>
212:     
213:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">product_sets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ps</span><span class="ruby-operator">|</span>
214:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">component</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">component</span>
215:         <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">quantity</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
216:           <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">destroy</span>
217:         <span class="ruby-keyword kw">else</span>
218:           <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span> = <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">quantity</span>
219:           <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">save</span>
220:         <span class="ruby-keyword kw">end</span>
221:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>
222:       <span class="ruby-keyword kw">end</span>
223:     <span class="ruby-keyword kw">end</span>
224:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
225:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000088" class="method-detail">
        <a name="M000088"></a>

        <div class="method-heading">
          <a href="#M000088" class="method-signature">
          <span class="method-name">rounded_price_before_rebate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000088-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000088-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 109</span>
109:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rounded_price_before_rebate</span>
110:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">price</span>.<span class="ruby-identifier">rounded</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rebate</span>
111:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">stock</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 354</span>
354:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stock</span>
355:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">componentized?</span>
356:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">component_stock</span>
357:     <span class="ruby-keyword kw">else</span>
358:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">read_attribute</span> <span class="ruby-operator">:</span><span class="ruby-identifier">stock</span>
359:     <span class="ruby-keyword kw">end</span>    
360:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000085" class="method-detail">
        <a name="M000085"></a>

        <div class="method-heading">
          <a href="#M000085" class="method-signature">
          <span class="method-name">taxes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000085-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000085-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/product.rb, line 83</span>
83:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">taxes</span>
84:     <span class="ruby-identifier">calculation</span> = <span class="ruby-value">0</span>
85:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">absolutely_priced?</span>
86:       <span class="ruby-identifier">calculation</span> = (<span class="ruby-identifier">sales_price</span>  <span class="ruby-operator">/</span> (<span class="ruby-value">100.0</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tax_class</span>.<span class="ruby-identifier">percentage</span>)) <span class="ruby-operator">*</span> <span class="ruby-identifier">tax_class</span>.<span class="ruby-identifier">percentage</span>
87:     <span class="ruby-keyword kw">else</span>
88:       <span class="ruby-identifier">calculation</span> = (<span class="ruby-identifier">gross_price</span> <span class="ruby-operator">/</span> <span class="ruby-value">100.0</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">tax_class</span>.<span class="ruby-identifier">percentage</span>
89:     <span class="ruby-keyword kw">end</span>
90:     <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">calculation</span>.<span class="ruby-identifier">to_s</span>)
91:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000101" class="method-detail">
        <a name="M000101"></a>

        <div class="method-heading">
          <a href="#M000101" class="method-signature">
          <span class="method-name">to_csv_array</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Convert this particular product instance into a CSV-compatible
representation that matches the header columns as given by <a
href="Product.html#M000100">Product.csv_header</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000101-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000101-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 282</span>
282:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_csv_array</span>
283:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Cart</span>.<span class="ruby-identifier">new</span>
284:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">add_product</span>(<span class="ruby-keyword kw">self</span>)
285:     <span class="ruby-identifier">shipped_price</span> = (<span class="ruby-identifier">price</span>.<span class="ruby-identifier">rounded</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">shipping_cost</span>)
286:     <span class="ruby-identifier">availability</span> = <span class="ruby-value str">&quot;24h&quot;</span>
287:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stock</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
288:       <span class="ruby-identifier">availability</span> = <span class="ruby-value str">&quot;ask&quot;</span>
289:     <span class="ruby-keyword kw">end</span>
290:     <span class="ruby-comment cmt"># We use string interpolation notation (#{foo}) so that nil errors are already</span>
291:     <span class="ruby-comment cmt"># handled gracefully without any extra work.</span>
292:     [<span class="ruby-node">&quot;#{id}&quot;</span>, <span class="ruby-node">&quot;#{manufacturer_product_code}&quot;</span>, <span class="ruby-node">&quot;#{name}&quot;</span>, <span class="ruby-node">&quot;#{description}&quot;</span>, <span class="ruby-node">&quot;#{net_price}&quot;</span>, <span class="ruby-node">&quot;#{price.rounded}&quot;</span>, <span class="ruby-node">&quot;#{shipped_price}&quot;</span>, <span class="ruby-node">&quot;#{taxes}&quot;</span>, <span class="ruby-node">&quot;#{c.shipping_cost}&quot;</span>, <span class="ruby-node">&quot;#{stock}&quot;</span>, <span class="ruby-node">&quot;#{availability}&quot;</span>, <span class="ruby-node">&quot;#{weight}&quot;</span>]
293:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000099" class="method-detail">
        <a name="M000099"></a>

        <div class="method-heading">
          <a href="#M000099" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000099-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000099-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 268</span>
268:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
269:     <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{id} #{name}&quot;</span>
270:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">weight</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Attribute overrides
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/product.rb, line 333</span>
333:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">weight</span>
334:     <span class="ruby-identifier">weight</span> = <span class="ruby-value">0</span>
335:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">componentized?</span>
336:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">product_sets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ps</span><span class="ruby-operator">|</span>
337:         <span class="ruby-identifier">weight</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">weight</span>
338:       <span class="ruby-keyword kw">end</span>
339:     <span class="ruby-keyword kw">else</span>
340:       <span class="ruby-identifier">weight</span> = <span class="ruby-identifier">read_attribute</span> <span class="ruby-identifier">:weight</span>
341:     <span class="ruby-keyword kw">end</span>
342:     
343:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">weight</span>
344:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>